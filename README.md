# 3D Tank Battle - 氛围编程实践记录

这是一个使用 **OhMyOpenCode (Claude Code + Sisyphus Agent)** 进行氛围编程的完整案例记录。

## 什么是氛围编程

氛围编程（Vibe Coding）是一种人机协作的编程方式：
- **人类**：提出需求、测试、反馈问题
- **AI**：编写代码、调试、修复、部署

你不需要懂代码，只需要会「描述想要什么」和「描述哪里不对」。

---

## 环境准备

| 工具 | 说明 |
|------|------|
| [Claude Code](https://claude.ai/code) | Anthropic 官方 CLI 工具 |
| [OhMyOpenCode](https://github.com/anthropics/anthropic-cookbook) | 增强配置，包含 Sisyphus Agent |
| 终端 | macOS Terminal / iTerm2 |
| 浏览器 | 用于测试游戏 |

---

## 完整对话过程

### 第一轮：提出需求

**我说：**
> 帮我编写一个3D版的坦克大战。要求：1. 单文件形式，可以直接在浏览器中玩 2. 要好玩、能玩 3. 只用键盘控制，不用鼠标

**AI 做了什么：**
- 选择 Three.js 作为 3D 引擎
- 一次性生成完整的 1000+ 行代码
- 包含：3D 场景、坦克模型、敌人 AI、碰撞检测、计分系统、小地图

**产出：** `tank-battle-3d.html` 可直接运行的游戏

---

### 第二轮：难度调整

**我说：**
> 初始距离太近，一上来满屏都是敌人，难度太高了。把难度拉开阶梯档次。

**AI 做了什么：**
- 设计了 4 个难度阶梯（Wave 1 教学、2-3 简单、4-6 中等、7+ 困难）
- 调整敌人生成距离、速度、射击冷却
- 降低攻击/追击触发距离

---

### 第三轮：发现 Bug

**我说：**
> 教学局出现了仨坦克，有的卡在墙里。Wave 1 过后直接跳到 Wave 123。

**AI 做了什么：**
- 定位根因：波次完成检测在每帧都执行，导致 wave++ 累加上百次
- 添加 `waveInProgress` 标志防止重复触发
- 添加生成位置碰撞检测，避免卡墙

---

### 第四轮：AI 行为问题

**我说：**
> 敌人坦克不知道向我移动攻击，不知道开火。走到它跟前它也不开火。

**AI 做了什么：**
- 发现 `shoot()` 被调用两次：AI 内部调用后子弹丢失，游戏循环再调用时冷却已消耗
- 改用 `wantsToShoot` 标志，统一由游戏循环处理开火
- 扩大攻击/追击距离

---

### 第五轮：请求专家审核

**我说：**
> 你能不能用 GPT 帮助我审核一下代码，看看还有没有其他的逻辑问题？

**AI 做了什么：**
- 调用 **Oracle Agent**（GPT-5.2 高级推理模型）进行代码审核
- Oracle 返回 7 个问题（按严重程度排序）：
  1. Critical: 敌人生成位置验证失败仍生成
  2. High: 视线检测距离计算错误
  3. High: 移动/子弹速度依赖帧率
  4. High: GPU 内存泄漏
  5. Medium: 波次计时器游戏结束后触发
  6. Medium: 子弹碰撞检测 Y 轴问题
  7. Medium: 坦克碰撞盒尺寸不匹配

---

### 第六轮：批量修复

**我说：**
> 好的，你来修复

**AI 做了什么：**
- 创建 Todo 列表跟踪 7 个修复任务
- 逐一修复并标记完成：
  - 添加生成位置重试机制（最多 50 次）
  - 修正射线检测使用 `raycaster.far`
  - 添加 `deltaTime` 计算，所有运动乘以 dt
  - 添加 `geometry.dispose()` 和 `material.dispose()`
  - 添加 `waveTimer` 变量，游戏结束时清除
  - 改用 XZ 平面距离检测
  - 调整碰撞盒尺寸 (4,3,6) → (5,3,7)

---

### 第七轮：又发现问题

**我说：**
> 后来炮管就一直保持角度，导致歪脖子转圈儿。

**AI 做了什么：**
- 定位问题：`patrol` 状态下不调用 `aimAt()`，炮塔保持固定角度
- 修复：巡逻状态下让炮塔慢慢回到正前方

---

### 第八轮：部署上线

**我说：**
> 我要是想公开分享让别人点击链接玩耍，又不想花钱。有可能吗？

**AI 做了什么：**
- 推荐 GitHub Pages（免费）
- 一键执行部署命令：
  ```bash
  mkdir tank-game && cp tank-battle-3d.html tank-game/index.html
  cd tank-game && git init && git add . && git commit -m "..."
  gh repo create tank-battle-3d --public --source=. --push
  gh api repos/.../pages -X POST  # 启用 GitHub Pages
  ```

**最终产出：** https://wshuyi.github.io/tank-battle-3d/

---

## 使用的 Agent

| Agent | 用途 | 调用时机 |
|-------|------|----------|
| **Sisyphus** (主 Agent) | 代码编写、调试、部署 | 全程 |
| **Oracle** (GPT-5.2) | 深度代码审核 | 用户主动要求审核时 |

---

## 关键心得

### 1. 描述问题比描述方案更重要
- ❌ "把 waveInProgress 设为 true"
- ✅ "Wave 1 过后直接跳到 Wave 123"

### 2. 及时测试，小步迭代
每次修改后立即测试，发现问题马上反馈，避免问题累积。

### 3. 善用专家审核
自己发现不了的问题，让 Oracle 帮忙找。它能从更高视角审视代码质量。

### 4. 不用懂代码
整个过程我没写一行代码，只是：
- 描述想要什么
- 描述哪里不对
- 确认修复结果

---

## 时间线

| 阶段 | 耗时 | 内容 |
|------|------|------|
| 初版完成 | ~2 分钟 | 1000+ 行完整游戏 |
| 难度调整 | ~1 分钟 | 4 级难度阶梯 |
| Bug 修复 x3 | ~5 分钟 | 波次跳级、卡墙、AI 不开火 |
| Oracle 审核 | ~1 分钟 | 发现 7 个潜在问题 |
| 批量修复 | ~3 分钟 | 修复全部 7 个问题 |
| 炮塔问题 | ~1 分钟 | 歪脖子转圈修复 |
| 部署上线 | ~1 分钟 | GitHub Pages |
| **总计** | **~15 分钟** | 从零到上线 |

---

## 游戏操作

- **WASD** - 移动坦克
- **Q/E** - 旋转炮塔
- **空格** - 开火
- **R** - 修理（消耗 50 分）
- **Enter** - 开始/重玩

---

## 链接

- 游戏地址：https://wshuyi.github.io/tank-battle-3d/
- 源码仓库：https://github.com/wshuyi/tank-battle-3d
